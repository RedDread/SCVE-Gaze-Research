package uk.ac.salford.cvefm.controller 
{
	import flash.events.Event;
	import flash.events.EventDispatcher;
	import flash.geom.Point;
	import uk.ac.salford.cvefm.model.CardData;
	import uk.ac.salford.cvefm.model.PlayerData;
	/**
	 * Singleton Class
	 * @author Claire Miller
	 */
	public class PokerDataController extends EventDispatcher
	{
		public static const NEXT_ROUND:String = "PokerDataController_NextRound";
		public static const GAME_END:String = "PokerDataController_End";
		
		public static const PRE_FLOP:String = "Pre-Flop";
		public static const FLOP:String = "Flop";
		public static const TURN:String = "Turn";
		public static const RIVER:String = "River";
		
		public static const GAME_STATES:Array = new Array (PRE_FLOP, FLOP, TURN, RIVER);
		public static const NUM_PLAYERS:Number = 3;
		
		private static var _instance:PokerDataController;
		private static var _allowInstantation:Boolean;		
		
		private var _cardData:CardData;
		
		private var _currentRound:Number;
		private var _currentPlayer:Number;
		
		private var _players:Array;		
		private var _sharedCardsPos:Point;
		
		/**
		* Get singleton instance of this class
		* @return this!!
		*/
		public static function getInstance () :PokerDataController
		{
			if (_instance == null)
			{
				_allowInstantation = true;
				_instance = new PokerDataController ();
			}
			
			return _instance;
		}
		
		/**
		* Data Manager constructor
		*/		
		public function PokerDataController ()
		{
			if (!_allowInstantation) 
			{
				throw new Error ("Error: Instantiation failed: Use PokerDataController.getInstance() instead of new.");
			}
			
			//MonsterDebugger.trace (this, "PokerDataController::PokerDataController ", BuildEnvironment.DEBUG_COLOUR_DATA);
			
			_allowInstantation = false;
			
			_cardData = new CardData ();			
			
			var playerOne:PlayerData = new PlayerData (1200, 250, 180);
			var playerTwo:PlayerData = new PlayerData (100, 550, 45);
			var playerThree:PlayerData = new PlayerData (1400, 900, -45);
			
			_sharedCardsPos = new Point (700, 450);
			
			_players = new Array (playerOne, playerTwo, playerThree);
			
			_currentRound = 0;
			_currentPlayer = 0; // CMTODO - probably need to change how this works
		}		
		
		public function get currentRound () :Number
		{
			return _currentRound;
		}
		
		public function get currentPlayer () :Number
		{
			return _currentPlayer;
		}
		
		public function moveToNextPlayer () :void
		{
			_currentPlayer++;
			if (_currentPlayer >= NUM_PLAYERS)
			{
				_currentRound++;
				_currentPlayer = 0;
				
				if (_currentRound >= GAME_STATES.length)
				{
					dispatchEvent (new Event (GAME_END, false));
				}
				else
				{
					dispatchEvent (new Event (NEXT_ROUND, false));
				}
			}
		}
		
		public function getCardData () :CardData
		{
			return _cardData;
		}
		
		public function getPlayerData (index:Number) :PlayerData
		{
			return _players[index];
		}
		
		public function get sharedCardsPoint ():Point { return _sharedCardsPos; }
		
		
	}

}