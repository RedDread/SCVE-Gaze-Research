package uk.ac.salford.cvefm.model 
{
	import flash.events.Event;
	import flash.events.EventDispatcher;
	import uk.ac.salford.cvefm.controller.PokerDataController;
	/**
	 * ...
	 * @author Claire Miller
	 */
	public class PokerPlayerData extends EventDispatcher
	{		
		private var _cardX:Number;
		private var _cardY:Number;
		private var _cardRotation:Number;
		
		private var _panelX:Number;
		private var _panelY:Number;
		private var _panelRotation:Number;
		
		private var _playersPotTotal:Number;
		private var _currentBet:Number;	
		
		private var _isActive:Boolean;
		private var _bankData:BankData;
		private var _playerId:Number;

		
		public function PokerPlayerData (xml:XML, playerId:Number)
		{
			_playerId = playerId;
			
			_cardX = xml.card.@x;
			_cardY = xml.card.@y;
			_cardRotation = xml.card.@rotation;
			
			_panelX = xml.panel.@x;
			_panelY = xml.panel.@y;
			_panelRotation = xml.panel.@rotation;
			
			_playersPotTotal = xml.@starting_pot;
			
			_isActive = true;
			
			_currentBet = 0;
			_bankData = PokerDataController.getInstance ().getBankData();
		}
		
		public function get playerId():Number { return _playerId; }
		public function get isActive():Boolean { return _isActive; }

		public function get cardX():Number { return _cardX; }
		public function get cardY():Number { return _cardY; }
		public function get cardRotation():Number { return _cardRotation; }
		
		public function get panelX():Number { return _panelX; }
		public function get panelY():Number { return _panelY; }
		public function get panelRotation():Number { return _panelRotation; }
		
		public function get playersPotTotal():Number { return _playersPotTotal; }

		public function get currentBet():Number 
		{
			return _currentBet; 
		}
		
		public function set currentBet (betValue:Number) :void 
		{
			_currentBet = betValue; 
			trace ("PlayerData::currentBet " + _currentBet + " playerId:" + _playerId);
		}
		
		/**
		 * Bank the players cash at the end of the round
		 * @return
		 */
		public function bank () :void
		{
			trace ("PlayerData::bank bet:" + _currentBet + " _playersPotTotal (after bet):" + _playersPotTotal + " playerId:" +_playerId );
			
			_playersPotTotal -= _currentBet;
			_bankData.addToPot (_currentBet);
			
			_currentBet = 0;
			
			checkPlayerIsActive ();
		}
		
		public function claim () :void
		{
			_bankData.claim (_currentBet);
			_playersPotTotal += _currentBet;
			
			_currentBet = 0;
			
			checkPlayerIsActive ();
		}
		
		public function checkPlayerIsActive () :void
		{
			trace ("PlayerData::nextHand - resetting raises and blinds, player: " + _playerId + " total:" + _playersPotTotal);
			
			if (_playersPotTotal > 0)
			{
				_isActive = true;
			}
			else
			{
				_isActive = false;
			}
			
		}
		
		public function fold () :void
		{
			_isActive = false;
		}
	
		/**
		 * These change the raise values
		 */		
		public function increaseRaise () :void
		{
			_currentBet += _bankData.smallBlind;
		}
		
		public function decreaseRaise () :void
		{
			_currentBet -= _bankData.smallBlind;
		}
	}

}