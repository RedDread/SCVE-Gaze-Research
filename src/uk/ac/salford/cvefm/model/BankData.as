package uk.ac.salford.cvefm.model 
{
	import fl.controls.NumericStepper;
	import flash.events.Event;
	import flash.events.EventDispatcher;
	import flash.geom.Point;
	/**
	 * ...
	 * @author Claire Miller
	 */
	public class BankData extends EventDispatcher
	{
		public static const POT_CLAIMED:String = "BankData_PotClaimed";
		private var _currentBlindsIndex:Number;
		private var _largeBlind:Number;
		private var _smallBlind:Number;
		
		private var _lastPlayerToRaiseId:Number;
		private var _lastRaise:Number;
		private var _lastBet:Number;
		private var _pot:Number;
		
		private var _xml:XML;
		
		public function BankData (xml:XML) 
		{
			_currentBlindsIndex = 0
			_lastBet = 0;
			_lastRaise = 0;
			_pot = 0;
			
			_xml = xml;
			
			_smallBlind = _xml.blinds.blind[0].@small;
			_largeBlind = _xml.blinds.blind[0].@large;
		}
		
		public function get blindInterval () :Number { return _xml.blinds[0].@time; }
		public function get blindsPos () :Point { return new Point (_xml.blinds[0].@x, _xml.blinds[0].@y) }
		public function get blindsRot () :Number { return _xml.blinds[0].@rotation }
		
		public function get smallBlind () :Number { return _smallBlind; }
		public function get largeBlind () :Number { return _largeBlind; }
		
		public function getLastRaise () :Number { return _lastRaise; }
		public function get lastPlayerToRaiseId () :Number { return _lastPlayerToRaiseId; }
		
		public function lastRaise (raise:Number, playerId:Number) :void 
		{
			if (raise > _lastRaise)
			{
				_lastRaise = raise; 
				_lastPlayerToRaiseId = playerId;
			}
		}
				
		public function get lastBet () :Number { return _lastBet; }
		public function set lastBet (bet:Number) :void { _lastBet = bet; }
		
		public function get pot () :Number { return _pot; }
		public function addToPot (bet:Number) :void { _pot += bet; }
		public function claimPot () :Number 
		{
			var temp:Number = _pot;
			_pot = 0;
			_lastRaise = 0;
			_lastBet
			
			trace ("BankData::claimPot");
			return temp;
		}
		
		//Lalala late night hacky hacky
		public function nextGame () :void
		{
			this.dispatchEvent(new Event (POT_CLAIMED));	
		}
		
		public function nextRound () :void
		{
			_currentBlindsIndex++;
			
			if (_currentBlindsIndex >= _xml.blinds.blind.length())
			{
				throw new Error ("BankData::nextRound no more blinds");
			}
			
			_smallBlind = _xml.blinds.blind[_currentBlindsIndex].@small;
			_largeBlind = _xml.blinds.blind[_currentBlindsIndex].@large;
			
			//trace ("BankData::nextRound _currentBlindsIndex:" + _currentBlindsIndex);
			//trace ("BankData::nextRound _smallBlind:" + _smallBlind);
			//trace ("BankData::nextRound _largeBlind:" + _largeBlind);
		}	
	}

}